{"ast":null,"code":"import{useEffect,useRef,useState}from'react';import{WS_URL}from'../config';import{useAuth}from'../context/AuthContext';import{api}from'../services/api';import SockJS from'sockjs-client';import{Stomp}from'@stomp/stompjs';import{config}from'../config';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export var useWebSocket=()=>{const[stompClient,setStompClient]=useState(null);const[lastMessage,setLastMessage]=useState(null);useEffect(()=>{// Use secure WebSocket URL\nconst socket=new SockJS(config.wsUrl);const client=Stomp.over(socket);client.connect({},()=>{client.subscribe('/topic/messages',message=>{setLastMessage(JSON.parse(message.body));});});setStompClient(client);return()=>{if(client){client.disconnect();}};},[]);const sendMessage=content=>{if(stompClient){stompClient.send(\"/app/chat\",{},JSON.stringify({content}));}};return{sendMessage,lastMessage};};const Register=()=>{const[email,setEmail]=useState('');const[password,setPassword]=useState('');const{login}=useAuth();const handleSubmit=async e=>{e.preventDefault();try{const response=await api.post('/auth/register',{email,password});if(response.data.token){login(response.data.token);}}catch(error){console.error('Registration failed:',error);}};return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:email,onChange:e=>setEmail(e.target.value),required:true}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:password,onChange:e=>setPassword(e.target.value),required:true}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Register\"})]});};useWebSocket=()=>{const[lastMessage,setLastMessage]=useState(null);const wsRef=useRef(null);useEffect(()=>{// Use secure WebSocket URL from config\nwsRef.current=new WebSocket(WS_URL);wsRef.current.onmessage=event=>{const message=JSON.parse(event.data);setLastMessage(message);};return()=>{if(wsRef.current){wsRef.current.close();}};},[]);const sendMessage=message=>{var _wsRef$current;if(((_wsRef$current=wsRef.current)===null||_wsRef$current===void 0?void 0:_wsRef$current.readyState)===WebSocket.OPEN){wsRef.current.send(JSON.stringify(message));}};return{sendMessage,lastMessage};};export default Register;","map":{"version":3,"names":["useEffect","useRef","useState","WS_URL","useAuth","api","SockJS","Stomp","config","jsx","_jsx","jsxs","_jsxs","useWebSocket","stompClient","setStompClient","lastMessage","setLastMessage","socket","wsUrl","client","over","connect","subscribe","message","JSON","parse","body","disconnect","sendMessage","content","send","stringify","Register","email","setEmail","password","setPassword","login","handleSubmit","e","preventDefault","response","post","data","token","error","console","onSubmit","children","type","value","onChange","target","required","wsRef","current","WebSocket","onmessage","event","close","_wsRef$current","readyState","OPEN"],"sources":["/Users/lszydlowski/Desktop/czat_portal/frontend/src/hooks/useWebSocket.js"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\nimport { WS_URL } from '../config';\nimport { useAuth } from '../context/AuthContext';\nimport { api } from '../services/api';\nimport SockJS from 'sockjs-client';\nimport { Stomp } from '@stomp/stompjs';\nimport { config } from '../config';\n\nexport var useWebSocket = () => {\n  const [stompClient, setStompClient] = useState(null);\n  const [lastMessage, setLastMessage] = useState(null);\n\n  useEffect(() => {\n    // Use secure WebSocket URL\n    const socket = new SockJS(config.wsUrl);\n    const client = Stomp.over(socket);\n\n    client.connect({}, () => {\n      client.subscribe('/topic/messages', (message) => {\n        setLastMessage(JSON.parse(message.body));\n      });\n    });\n\n    setStompClient(client);\n\n    return () => {\n      if (client) {\n        client.disconnect();\n      }\n    };\n  }, []);\n\n  const sendMessage = (content) => {\n    if (stompClient) {\n      stompClient.send(\"/app/chat\", {}, JSON.stringify({ content }));\n    }\n  };\n\n  return { sendMessage, lastMessage };\n};\n\nconst Register = () => {\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const { login } = useAuth();\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    try {\n      const response = await api.post('/auth/register', { email, password });\n      if (response.data.token) {\n        login(response.data.token);\n      }\n    } catch (error) {\n      console.error('Registration failed:', error);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <input type=\"email\" value={email} onChange={(e) => setEmail(e.target.value)} required />\n      <input type=\"password\" value={password} onChange={(e) => setPassword(e.target.value)} required />\n      <button type=\"submit\">Register</button>\n    </form>\n  );\n};\n\nuseWebSocket = () => {\n  const [lastMessage, setLastMessage] = useState(null);\n  const wsRef = useRef(null);\n\n  useEffect(() => {\n    // Use secure WebSocket URL from config\n    wsRef.current = new WebSocket(WS_URL);\n\n    wsRef.current.onmessage = (event) => {\n      const message = JSON.parse(event.data);\n      setLastMessage(message);\n    };\n\n    return () => {\n      if (wsRef.current) {\n        wsRef.current.close();\n      }\n    };\n  }, []);\n\n  const sendMessage = (message) => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify(message));\n    }\n  };\n\n  return { sendMessage, lastMessage };\n};\n\nexport default Register;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}